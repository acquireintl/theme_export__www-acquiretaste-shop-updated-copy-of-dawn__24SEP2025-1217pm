{%- comment -%} Featured collection (safe) {%- endcomment -%}
{%- liquid
  assign products_to_display = section.settings.products_to_show | default: 8
  assign columns_desktop = section.settings.columns_desktop | default: 4
  assign picked_collection = section.settings.collection
  if picked_collection == blank
    assign picked_collection = collections['all']
  endif
  if picked_collection == blank and collections.size > 0
    for col in collections
      assign picked_collection = col
      break
    endfor
  endif
  assign collection_for_grid = picked_collection
  assign has_products = false
  if collection_for_grid and collection_for_grid.products_count > 0
    assign has_products = true
  endif
-%}

<div class="color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width section-{{ section.id }}-padding">
    {% if section.settings.title != blank %}
      <h2 class="title inline-richtext {{ section.settings.heading_size }}">{{ section.settings.title }}</h2>
    {% endif %}

    {% if has_products %}
      {%- paginate collection_for_grid.products by products_to_display -%}
      <ul class="grid product-grid grid--{{ section.settings.columns_mobile | default: '2' }}-col-tablet-down grid--{{ columns_desktop }}-col-desktop">
        {%- for product in collection_for_grid.products -%}
          {%- assign __lazy = false -%}{% if forloop.index > 2 %}{%- assign __lazy = true -%}{% endif %}
          <li class="grid__item">
            {% render 'card-product',
              card_product: product,
              media_aspect_ratio: section.settings.image_ratio,
              image_shape: section.settings.image_shape,
              show_vendor: section.settings.show_vendor,
              lazy_load: __lazy %}
          </li>
        {%- endfor -%}
      </ul>
      {%- endpaginate -%}
    {% else %}
      <ul class="grid product-grid grid--{{ section.settings.columns_mobile | default: '2' }}-col-tablet-down grid--{{ columns_desktop }}-col-desktop">
        {%- for i in (1..columns_desktop) -%}
          <li class="grid__item">
            {% assign ridx = forloop.rindex %}
            {% case ridx %}{% when 5 %}{% assign ridx = 1 %}{% when 6 %}{% assign ridx = 2 %}{% endcase %}
            {% assign placeholder_image = 'product-apparel-' | append: ridx %}
            {% render 'card-product',
              media_aspect_ratio: section.settings.image_ratio,
              image_shape: section.settings.image_shape,
              show_vendor: section.settings.show_vendor,
              lazy_load: false,
              placeholder_image: placeholder_image %}
          </li>
        {%- endfor -%}
      </ul>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Featured collection (safe)",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "inline_richtext", "id": "title", "label": "Heading" },
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "products_to_show", "label": "Products to show", "min": 2, "max": 24, "step": 2, "default": 8 },
    { "type": "select", "id": "columns_desktop", "label": "Columns on desktop",
      "options": [{"value":"2","label":"2"},{"value":"3","label":"3"},{"value":"4","label":"4"}],
      "default": "4" },
    { "type": "select", "id": "columns_mobile", "label": "Columns on mobile",
      "options": [{"value":"1","label":"1"},{"value":"2","label":"2"}],
      "default": "2" },
    { "type": "select", "id": "image_ratio", "label": "Image ratio",
      "options": [{"value":"adapt","label":"Adapt to image"},{"value":"square","label":"Square"},{"value":"portrait","label":"Portrait"}],
      "default": "adapt" },
    { "type": "select", "id": "image_shape", "label": "Image shape",
      "options": [{"value":"default","label":"Default"},{"value":"arch","label":"Arch"}],
      "default": "default" },
    { "type": "checkbox", "id": "show_vendor", "label": "Show vendor", "default": false }
  ],
  "presets": [{ "name": "Featured collection (safe)" }]
}
{% endschema %}
